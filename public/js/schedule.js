$(document).ready(function(){function e(){function e(e){this.element=e,this.timeline=this.element.find(".timeline"),this.timelineItems=this.timeline.find("li"),this.timelineItemsNumber=this.timelineItems.length,this.timelineStart=n(this.timelineItems.eq(0).text()),this.timelineUnitDuration=n(this.timelineItems.eq(1).text())-n(this.timelineItems.eq(0).text()),this.eventsWrapper=this.element.find(".events"),this.eventsGroup=this.eventsWrapper.find(".events-group"),this.singleEvents=this.eventsGroup.find(".single-event"),this.eventSlotHeight=this.eventsGroup.eq(0).children(".top-info").outerHeight(),this.modal=this.element.find(".event-modal"),this.modalHeader=this.modal.find(".header"),this.modalHeaderBg=this.modal.find(".header-bg"),this.modalBody=this.modal.find(".body"),this.modalBodyBg=this.modal.find(".body-bg"),this.modalMaxWidth=800,this.modalMaxHeight=480,this.animating=!1,this.initSchedule()}function t(){function t(){a.forEach(function(e){e.scheduleReset()}),i=!1}var n=$(".cd-schedule"),a=[],i=!1;if(n.length>0)if(n.each(function(t){a.push(new e($(this)))}),$(".single-event").length>0){var s=$($(".single-event")[Math.floor(Math.random()*$(".single-event").length)]).offset().top;$("#loading").modal("hide"),$("html, body").animate({scrollTop:s-400},500)}else $("html, body").animate({scrollTop:0},500);$(window).on("resize",function(){i||(i=!0,window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t))}),$(window).keyup(function(e){27==e.keyCode&&a.forEach(function(e){e.closeModal(e.eventsGroup.find(".selected-event"))})})}function n(e){e=e.replace(/ /g,"");var t=e.split(":");return 60*parseInt(t[0])+parseInt(t[1])}function a(e,t){e.css({"-moz-transform":t,"-webkit-transform":t,"-ms-transform":t,"-o-transform":t,transform:t})}var i=0,s="webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",o=$(".csstransitions").length>0;return o||(s="noTransition"),e.prototype.initSchedule=function(){this.scheduleReset(),this.initEvents(),this.placeEvents()},e.prototype.scheduleReset=function(){var e=this.mq();"desktop"!=e||this.element.hasClass("js-full")?"mobile"==e&&this.element.hasClass("js-full")?(this.element.removeClass("js-full loading"),this.eventsGroup.children("ul").add(this.singleEvents).removeAttr("style"),this.eventsWrapper.children(".grid-line").remove(),this.element.hasClass("modal-is-open")&&this.checkEventModal()):"desktop"==e&&this.element.hasClass("modal-is-open")?(this.checkEventModal("desktop"),this.element.removeClass("loading")):(this.placeEvents(),this.element.removeClass("loading")):(this.eventSlotHeight=this.eventsGroup.eq(0).children(".top-info").outerHeight(),this.element.addClass("js-full"),this.placeEvents(),this.element.hasClass("modal-is-open")&&this.checkEventModal())},e.prototype.initEvents=function(){var e=this;this.singleEvents.each(function(){var t=e.singleEvents.length>2?"0.7em":"1em",n='<span class="event-date" style="overflow: hidden;font-size:'+t+'">'+$(this).data("start")+" - "+$(this).data("end")+"</span>";$(this).children("a").prepend($(n)),$(this).on("click","a",function(t){t.preventDefault(),e.animating||e.openModal($(this)),$("#calendarPicker").hide()})}),this.modal.on("click",".close",function(t){t.preventDefault(),e.animating||e.closeModal(e.eventsGroup.find(".selected-event")),$("#calendarPicker").show()}),this.modal.find(".event-info").on("submit","#updateForm",function(t){$.ajax({method:$(this).attr("method"),url:$(this).attr("action"),data:$(this).serialize(),success:function(t){e.closeModal(e.eventsGroup.find(".selected-event")),e.placeEvents()},error:function(e){formErrors(e,$(this))}}),t.preventDefault()}),this.modal.find(".event-info").on("submit","#deleteForm",function(t){$.ajax({method:$(this).attr("method"),url:$(this).attr("action"),data:$(this).serialize(),success:function(t){e.closeModal(e.eventsGroup.find(".selected-event")),e.placeEvents()},error:function(e){formErrors(e,$(this))}}),t.preventDefault()}),this.element.on("click",".cover-layer",function(t){!e.animating&&e.element.hasClass("modal-is-open")&&(e.closeModal(e.eventsGroup.find(".selected-event")),e.placeEvents(),$("#calendarPicker").show())})},e.prototype.placeEvents=function(){var e,t=this,a=[],i=[],s=0,o=0,d=0,r=this.mq();for(s=0;s<1440;s++)a[s]=[];this.eventsGroup.each(function(){i=[];var l=$(this).find(".single-event");if(l.length>0){for(l.sort(function(e,t){return-(parseInt(e.dataset.id)-parseInt(t.dataset.id))}),s=0,l.each(function(){var e=n($(this).attr("data-start")),t=n($(this).attr("data-end"));i.push({id:s,start:e,end:t}),++s}),d=i.length,s=0;s<d;s++){if(e=i[s],e.start>e.end){var m=e.start;e.start=e.end,e.end=m}for(o=e.start;o<e.end;o++)a[o].push(e.id)}var h=!1;for(s=0;s<1440;s++){var c=0,u=a[s].length;if(u>0)for(o=0;o<u;o++)e=i[a[s][o]],void 0===e?(e=i[a[s][o]-1],h=!0):h=!1,(void 0===e.cevc||!e.cevc||e.cevc<u)&&(h||(e.cevc=u),e.hindex||(e.hindex=c,c++))}var f=$(l[0]).parent().width(),v=void 0;for(s=0;s<d;++s){e=i[s];var p=e.end-e.start;e.pxh=t.eventSlotHeight*p/t.timelineUnitDuration,e.pxy=t.eventSlotHeight*(e.start-t.timelineStart)/t.timelineUnitDuration,v=e.cevc===d?e.cevc:d,e.pxw=f/v,e.pxx=e.hindex*e.pxw,"desktop"==r?(l[s].style.width=e.pxw+"px",l[s].style.height=e.pxh+"px",l[s].style.top=e.pxy+"px",l[s].style.left=e.pxx+"px"):($(l[s]).css("width",""),$(l[s]).css("left",""),$(l[s]).css("top",""),$(l[s]).css("height",""))}}}),this.element.removeClass("loading")},e.prototype.openModal=function(e){var t=this,n=t.mq();if(this.animating=!0,i=$(e).parent().width(),$(e).parent().css("width",""),this.modalHeader.find(".event-name").text(e.find(".event-name").text()),this.modalHeader.find(".event-date").text(e.find(".event-date").text()),this.modal.attr("data-event",e.parent().attr("data-event")),location.href.includes("/schedule/editing")?$.ajax({method:"GET",url:"/schedule/"+e.parent().attr("data-slug")+"/edit",success:function(e){t.modalBody.find(".event-info").html(e)}}):t.modalBody.find(".event-info").html('<div style="color: black;font-size: 110%;">'+e.parent().attr("data-content")+"</div>"),t.element.addClass("content-loaded"),t.element.addClass("modal-is-open"),setTimeout(function(){e.parent("li").addClass("selected-event")},10),"mobile"==n)t.modal.one(s,function(){t.modal.off(s),t.animating=!1}),t.modal.css("z-index",99999);else{var d=e.offset().top-$(window).scrollTop(),r=e.offset().left,l=e.innerHeight(),m=e.innerWidth(),h=$(window).width(),c=$(window).height(),u=.8*h>t.modalMaxWidth?t.modalMaxWidth:.8*h,f=.8*c>t.modalMaxHeight?t.modalMaxHeight:.8*c,v=parseInt((h-u)/2-r),p=parseInt((c-f)/2-d),g=f/l,y=u-m;t.modal.css({top:d+"px",left:r+"px",height:f+"px",width:u+"px"}),t.modal.css("z-index",99999),a(t.modal,"translateY("+p+"px) translateX("+v+"px)"),t.modalHeader.css({width:m+"px"}),t.modalBody.css({marginLeft:m+"px"}),t.modalBodyBg.css({height:l+"px",width:"1px"}),a(t.modalBodyBg,"scaleY("+g+") scaleX("+y+")"),t.modalHeaderBg.css({height:l+"px",width:m+"px"}),a(t.modalHeaderBg,"scaleY("+g+")"),t.modalHeaderBg.one(s,function(){t.modalHeaderBg.off(s),t.animating=!1,t.element.addClass("animation-completed")})}o||t.modal.add(t.modalHeaderBg).trigger(s)},e.prototype.closeModal=function(e){var t=this,n=t.mq();if(this.animating=!0,e.animate({width:i},700),"mobile"==n)this.element.removeClass("modal-is-open"),this.modal.one(s,function(){t.modal.off(s),t.animating=!1,t.element.removeClass("content-loaded"),e.removeClass("selected-event")});else{var d=e.offset().top-$(window).scrollTop(),r=e.offset().left,l=e.innerHeight(),m=e.innerWidth(),h=Number(t.modal.css("top").replace("px","")),c=Number(t.modal.css("left").replace("px","")),u=r-c,f=d-h;t.element.removeClass("animation-completed modal-is-open"),this.modal.css({width:m+"px",height:l+"px"}),a(t.modal,"translateX("+u+"px) translateY("+f+"px)"),a(t.modalBodyBg,"scaleX(0) scaleY(1)"),a(t.modalHeaderBg,"scaleY(1)"),this.modalHeaderBg.one(s,function(){t.modalHeaderBg.off(s),t.modal.addClass("no-transition"),setTimeout(function(){t.modal.add(t.modalHeader).add(t.modalBody).add(t.modalHeaderBg).add(t.modalBodyBg).attr("style","")},10),setTimeout(function(){t.modal.removeClass("no-transition")},20),t.animating=!1,t.element.removeClass("content-loaded"),e.removeClass("selected-event")})}o||t.modal.add(t.modalHeaderBg).trigger(s)},e.prototype.mq=function(){return window.getComputedStyle(this.element.get(0),"::before").getPropertyValue("content").replace(/["']/g,"")},e.prototype.checkEventModal=function(e){this.animating=!0;var t=this,n=this.mq();if("mobile"==n)$(".cover-layer")[0].style.zIndex=88888,t.modal.add(t.modalHeader).add(t.modalHeaderBg).add(t.modalBody).add(t.modalBodyBg).attr("style",""),t.modal.removeClass("no-transition"),t.animating=!1,t.modal.css("z-index",99999);else if("desktop"==n&&t.element.hasClass("modal-is-open")){$(".cover-layer")[0].style.zIndex=88888,t.modal.addClass("no-transition"),t.element.addClass("animation-completed");var i=t.eventsGroup.find(".selected-event"),s=(i.offset().top,$(window).scrollTop(),i.offset().left,i.innerHeight()),o=i.innerWidth(),d=$(window).width(),r=$(window).height(),l=.8*d>t.modalMaxWidth?t.modalMaxWidth:.8*d,m=.8*r>t.modalMaxHeight?t.modalMaxHeight:.8*r,h=m/s,c=l-o;setTimeout(function(){t.modal.css({width:l+"px",height:m+"px",top:r/2-m/2+"px",left:d/2-l/2+"px",zIndex:99999}),a(t.modal,"translateY(0) translateX(0)"),t.modalBodyBg.css({height:m+"px",width:"1px"}),a(t.modalBodyBg,"scaleX("+c+")"),t.modalHeader.css({width:o+"px"}),t.modalBody.css({marginLeft:o+"px"}),t.modalHeaderBg.css({height:s+"px",width:o+"px"}),a(t.modalHeaderBg,"scaleY("+h+")")},10),setTimeout(function(){t.modal.removeClass("no-transition"),t.animating=!1},20)}},{load:t}}var t=new e,n=new Vue({el:"#calendar",data:{days:["Dimanche","Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi"],colors:["event-1","event-2","event-3","event-4"],weekevents:[]},computed:{},methods:{thisdayhaveanevent:function(e){return"undefined"!==this.weekevents[e]},getevent:function(e){return this.weekevents[e]},sort:function(e){var t=[],n=this;for(var a in e.weekevents)e.weekevents[a].forEach(function(e){e.color=n.colors[Math.floor(Math.random()*n.colors.length)]});for(var a in e.weekevents)e.weekevents[a].forEach(function(e){var i=e.end.split(" ");if(i.length>1){var s=i[1],o=JSON.parse(JSON.stringify(e));e.end="23:59",o.begin="00:00",o.end=s;for(var d=new Date(i[0]),r=d.getDate()-d.getDay(),l=r+6,m=new Date(d.setDate(l)).getDay(),h=new Date(i[0]),c=h.getDay()+1,u=n.getDateFromDayInCurrentCalendarDate(a).getDay()+1;u<=m;++u)if(n.getDateFromDayInCurrentCalendarDate(n.getStringDayFromNumberDay(u))<h){o.end="23:59";var f=n.getStringDayFromNumberDay(u);void 0===t[f]&&(t[f]=[]),t[f].push(o)}else if(u===c){var v=JSON.parse(JSON.stringify(o));v.end=s;var f=n.getStringDayFromNumberDay(u);void 0===t[f]&&(t[f]=[]),t[f].push(v)}}});for(var a in t)t[a].forEach(function(t){e.weekevents[a].push(t)});n.weekevents=e.weekevents},getScheduleTimestamp:function(e){e=e.replace(/ /g,"");var t=e.split(":");return 60*parseInt(t[0])+parseInt(t[1])},getNextDayFromStringDay:function(e){switch(e){case"Lundi":return"Mardi";case"Mardi":return"Mercredi";case"Mercredi":return"Jeudi";case"Jeudi":return"Vendredi";case"Vendredi":return"Samedi";case"Samedi":return"Dimanche";case"Dimanche":return"Lundi"}},getStringDayFromNumberDay:function(e){switch(e){case 0:return"Dimanche";case 1:return"Lundi";case 2:return"Mardi";case 3:return"Mercredi";case 4:return"Jeudi";case 5:return"Vendredi";case 6:return"Samedi"}},getDateFromDayInCurrentCalendarDate:function(e){var t=new Date(a.getDate(!1));switch(e){case"Dimanche":return new Date(t.setDate(t.getDate()-t.getDay()));case"Lundi":return new Date(t.setDate(t.getDate()-t.getDay()+1));case"Mardi":return new Date(t.setDate(t.getDate()-t.getDay()+2));case"Mercredi":return new Date(t.setDate(t.getDate()-t.getDay()+3));case"Jeudi":return new Date(t.setDate(t.getDate()-t.getDay()+4));case"Vendredi":return new Date(t.setDate(t.getDate()-t.getDay()+5));case"Samedi":return new Date(t.setDate(t.getDate()-t.getDay()+6))}},loadFromDate:function(e){var t=this;t.weekevents=[];var n=$("#loading");n.modal(),$.ajax({method:"GET",url:"/schedule/week/"+e,success:function(e){var a=!1;for(var i in e.weekevents)if(e.weekevents[i].length>0){a=!0;break}a&&t.sort(e),n.modal("hide")}})}},created:function(){},updated:function(){t.load()},mounted:function(){this.loadFromDate((new Date).format("yyyy-mm-dd"))},beforeMount:function(){}});dhtmlXCalendarObject.prototype.langData.fr={dateformat:"%Y.%m.%d",monthesFNames:["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Août","Septembre","Octobre","Novembre","Décembre"],monthesSNames:["Janv","Févr","Mar","Avr","Mai","Juin","Juill","Août","Sept","Oct","Nov","Déc"],daysFNames:["Dimanche","Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi"],daysSNames:["Dim","Lun","Mar","Mer","Jeu","Ven","Sam"],weekstart:1,weekname:"s"};var a=new dhtmlXCalendarObject("calendarPicker");a.loadUserLanguage("fr"),a.setDate(new Date),a.hideTime(),a.attachEvent("onBeforeChange",function(e){var t=e.format("yyyy-mm-dd");return n.loadFromDate(t),!0}),a.show(),$("#firstSection").height($("#secondSection").height());var i=Math.round(($("#firstSection").height()-$("#firstTable").height())/2);$("#firstTable").css("margin-top",i)});